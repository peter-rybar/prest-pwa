!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?o(require("leaflet"),require("store")):"function"==typeof define&&define.amd?define(["leaflet","store"],o):o(t.L,t.store)}(this,function(t,o){"use strict";function e(t,o){function e(){this.constructor=t}for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n]);t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}function n(t,o,e){if(t){for(var i=t[0],r=t[1],s=r&&r.constructor===Object,a=s?2:1,c=0,u=a;u<t.length;u++)t[u]&&t[u].constructor!==Function&&c++;var d,l=i.split("~"),p=l[1],f=l[0].split("."),h=f[0].split("#"),m=h[0]||"div",g=h[1],_=f.slice(1);d=s?r:{},g&&(d._id=g),_.length&&(d._classes=_),p&&(d._ref=p);if(!o.open(m,d,c,e))for(var u=a,v=t.length;u<v;u++){var y=t[u];if(void 0!==y)switch(y.constructor){case Array:n(y,o,e);break;case Function:o.fnc(y,e);break;case String:o.text(y,e);break;default:o.obj(y,e)}}o.close(m,c,e)}}function i(t,o){n(t,new c,o)}function r(t,o){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.constructor===String)IncrementalDOM.text(r);else if("toJsonML"in r){var s=r;i(s.toJsonML(),s)}else i(r,o)}}function s(t,o,e){IncrementalDOM.patch(t,function(t){return r(t,e)},o)}function a(t,o){self.Notification?(console.log("Notification supported"),Notification.requestPermission(function(e){"granted"===e?(console.log("Notification permission granted"),navigator.serviceWorker.ready.then(function(e){console.log("Notification SW ready"),e.showNotification(t,o)})):console.warn("Notification permission:",e)})):console.warn("Notification not supported")}var c=function(){function t(){}return t.prototype.open=function(t,o,e,n){var i=[],r=o._id,s=o._classes?o._classes:[],a=o._ref;for(var c in o)if(o.hasOwnProperty(c))switch(c){case"_id":case"_classes":case"_ref":case"_key":case"_skip":break;case"id":r=o[c];break;case"classes":s=s.concat(o[c]);break;case"class":s=s.concat(o[c].split(" "));break;case"data":for(var u in o[c])o[c].hasOwnProperty(u)&&(o[c][u].constructor===String?i.push("data-"+u,o[c][u]):i.push("data-"+u,JSON.stringify(o[c][u])));break;case"styles":i.push("style",o[c]);break;default:"function"==typeof o[c]?i.push("on"+c,o[c]):i.push(c,o[c])}return s.length&&i.unshift("class",s.join(" ")),r&&i.unshift("id",r),IncrementalDOM.elementOpen.apply(IncrementalDOM,[t,o._key||null,null].concat(i)),o._skip&&IncrementalDOM.skip(),n&&a&&(n.refs[a]=IncrementalDOM.currentElement()),!!o._skip},t.prototype.close=function(t,o,e){IncrementalDOM.elementClose(t)},t.prototype.text=function(t,o){IncrementalDOM.text(t)},t.prototype.fnc=function(t,o){t(IncrementalDOM.currentElement())},t.prototype.obj=function(t,o){"toJsonML"in t?n(t.toJsonML(),this,t):this.text(""+t,o)},t}(),u=function(){function t(o){void 0===o&&(o=""),this.type="Widget",this.id=this.type+"-"+t.__count++,this.refs={},o&&(this.type=o)}return t.prototype.mount=function(t){if(void 0===t&&(t=document.body),!this.dom){this.dom=t;s(t,this.render(),this),t.setAttribute("widget",this.type),this.onMount&&this.onMount()}return this},t.prototype.umount=function(){return this.dom&&(this.onUmount&&this.onUmount(),this.dom.hasAttribute("widget")&&this.dom.removeAttribute("widget"),this.dom.parentElement.removeChild(this.dom),this.dom=void 0),this},t.prototype.update=function(){var t=this;return this.dom&&!this._updateSched&&(this._updateSched=setTimeout(function(){t.dom&&s(t.dom,t.render(),t),t._updateSched=null},0)),this},t.prototype.toJsonML=function(){var t=this;if(this.dom){if(!this._updateSched)return["div",{_skip:!0,_id:this.id,_key:this.id,widget:this.type}];clearTimeout(this._updateSched),this._updateSched=null}var o=this.render();return["div",{_id:this.id,_key:this.id,widget:this.type}].concat(o,[function(o){t.dom||(t.dom=o,t.onMount&&t.onMount())}])},t}();u.__count=0;var d=function(n){function i(){var e=n.call(this,"MapWidget")||this;return e._imagePath="lib/leaflet/images/",e._onLoad=function(){e._boundsLoad()},e._onMoveEnd=function(t){e._boundsSave()},e._fromBBoxString=function(o){var e=o.split(",").map(parseFloat),n=e[0],i=e[1],r=e[2],s=e[3];return new t.LatLngBounds(new t.LatLng(i,n),new t.LatLng(s,r))},e._onLocationFound=function(n){var i=n.accuracy/2;t.marker(n.latlng).addTo(e._map).bindPopup("<strong>Me</strong>, radius "+i.toFixed(0)+"&thinsp;m").openPopup(),t.circle(n.latlng,i).addTo(e._map),o.set("located",!0)},e._onLocationError=function(t){alert(t.message)},e}return e(i,n),i.prototype.onMount=function(){var t=this;setTimeout(function(){return t._render(t.refs.map)},0)},i.prototype.render=function(){return[["div~map",{_skip:!!this._map,style:"width: 100%; height: 100%"}]]},i.prototype._render=function(e){this._imagePath&&(t.Icon.Default.imagePath=this._imagePath);var n=t.map(e,{minZoom:4,scrollWheelZoom:!0});this._map=n,n.on("load",this._onLoad),n.fitWorld();var i=t.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{maxZoom:18,attribution:'<a href="http://osm.org/copyright">OpenStreetMap</a>',id:"prest-pwa.map"});n.addLayer(i),n.on("moveend",this._onMoveEnd),n.on("locationfound",this._onLocationFound),n.on("locationerror",this._onLocationError),n.locate({setView:!o.get("located"),maxZoom:16});var r=t.Control;r.geocoder({collapsed:!0,position:"topright",placeholder:"Search",errorMessage:"No results",geocoder:new r.Geocoder.Nominatim,showResultIcons:!1,defaultMarkGeocode:!1}).on("markgeocode",function(t){var o=t.geocode.bbox;n.fitBounds(o)}).addTo(n)},i.prototype._boundsSave=function(){var t=this._map.getBounds();o.set("bounds",t.toBBoxString())},i.prototype._boundsLoad=function(){var t=o.get("bounds");if(t){var e=this._fromBBoxString(t);this._map.fitBounds(e)}else this._map.fitWorld()},i}(u);!function(){"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").then(function(t){t.installing?console.log("Service worker installing"):t.waiting?console.log("Service worker installed"):t.active&&console.log("Service worker active"),console.log("Registration succeeded. Scope is "+t.scope)}).catch(function(t){console.error("Registration failed with "+t)})}();var l=new d;l.mount(),setTimeout(function(){a("Notif title",{body:"Notif body",icon:"assets/icons/ic-face.png",tag:"notif-tag"})},3e3),self.app=l,self.VERSION="0.0.0"});
//# sourceMappingURL=index.js.map
